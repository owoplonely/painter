(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{37:function(t,e,a){t.exports=a(75)},42:function(t,e,a){},45:function(t,e,a){},72:function(t,e){},75:function(t,e,a){"use strict";a.r(e);var o=a(0),n=a.n(o),r=a(6),i=a.n(r),s=(a(42),a(7)),l=a(8),c=a(10),p=a(9),u=a(11),h=a(19),d=a.n(h),f=a(34);var v=function(t){function e(t){var a;return Object(s.a)(this,e),(a=Object(c.a)(this,Object(p.a)(e).call(this,t))).setUpDragHandler=function(){var t,e,o,n,r,i,s=!1;a.canvasWrapper.addEventListener("mousedown",function(r){t=parseFloat(a.canvasWrapper.style.top),e=parseFloat(a.canvasWrapper.style.left),o=r.clientX,n=r.clientY,s=!0}),a.canvasWrapper.addEventListener("mouseup",function(t){s=!1,Math.sqrt(Math.pow(r,2)+Math.pow(i,2))<3&&a.handleDotClick(t)}),a.canvasWrapper.addEventListener("mousemove",function(l){s&&(r=l.clientX-o,i=l.clientY-n,a.canvasWrapper.style.left=e+r+"px",a.canvasWrapper.style.top=t+i+"px")}),a.canvasWrapper.addEventListener("mousemove",function(t){var e=Math.floor(t.layerX/a.state.zoomRatio)*a.state.zoomRatio,o=Math.floor(t.layerY/a.state.zoomRatio)*a.state.zoomRatio;a.setState({dothoverX:e+"px",dothoverY:o+"px"})})},a.setUpZoomHandler=function(){a.canvasWrapper.addEventListener("wheel",function(t){var e=a.state.zoomRatio,o=t.deltaY<0?e+1:e-1;o<1&&(o=1,a.canvasWrapper.style.left=0,a.canvasWrapper.style.top=0),a.setState({zoomRatio:o});var n=(o/e-1)*t.layerX,r=(o/e-1)*t.layerY;a.canvasWrapper.style.left=parseFloat(a.canvasWrapper.style.left)-n+"px",a.canvasWrapper.style.top=parseFloat(a.canvasWrapper.style.top)-r+"px",t.preventDefault()})},a.draw=function(t,e,o){a.ctx.fillStyle=o,a.ctx.fillRect(t,e,1,1)},a.handleDotClick=function(t){var e=parseInt(t.layerX/a.state.zoomRatio),o=parseInt(t.layerY/a.state.zoomRatio);a.props.socket.emit("draw-dot",{x:e,y:o,color:a.props.color})},a.setUpPickHandler=function(){a.canvas.addEventListener("mousemove",function(t){if(a.state.isPickingColor){console.log(t.layerX,t.layerY);var e=function(t){var e=document.createElement("canvas"),a=e.getContext("2d");return e.width=41,e.height=41,a.beginPath(),a.lineWidth=2,a.strokeStyle="#000000",a.moveTo(0,6),a.lineTo(12,6),a.moveTo(6,0),a.lineTo(6,12),a.stroke(),a.beginPath(),a.arc(25,25,14,0,2*Math.PI,!1),a.lineWidth=2,a.strokeStyle="#000000",a.stroke(),a.beginPath(),a.arc(25,25,13.4,0,2*Math.PI,!1),a.fillStyle=t,a.fill(),e.toDataURL()}("rgba("+a.ctx.getImageData(parseInt(t.layerX/a.state.zoomRatio),parseInt(t.layerY/a.state.zoomRatio),1,1).data+")");a.canvas.style.cursor="url(".concat(e,") 6 6, crosshair")}}),a.canvas.addEventListener("click",function(t){if(a.state.isPickingColor){var e="#"+Array.from(a.ctx.getImageData(parseInt(t.layerX/a.state.zoomRatio),parseInt(t.layerY/a.state.zoomRatio),1,1).data).slice(0,3).map(function(t){return t.toString(16).padEnd(2,"0")}).join("");console.log(e),a.props.onPickColor(e),a.setState({isPickingColor:!1}),a.canvas.style.cursor=""}})},a.setPickColorState=function(){a.setState({isPickingColor:!0})},a.canvas=null,a.state={zoomRatio:1,dothoverX:-1,dotHoverY:-1,isPickingColor:!1},a}return Object(u.a)(e,t),Object(l.a)(e,[{key:"componentDidMount",value:function(){var t=this;this.setUpZoomHandler(),this.setUpDragHandler(),this.setUpPickHandler(),this.ctx=this.canvas.getContext("2d"),this.props.socket.on("init-data",function(){var e=Object(f.a)(d.a.mark(function e(a){var o,n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(t){return new Promise(function(e){var a=new Blob([t],{type:"image/png"}),o=new Image;o.onload=function(){return e(o)};var n=URL.createObjectURL(a);o.src=n})},e.next=3,n(a);case 3:o=e.sent,t.canvas.width=o.width,t.canvas.height=o.height,t.ctx.drawImage(o,0,0);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),this.props.socket.on("update-dot",function(e){var a=e.x,o=e.y,n=e.color;t.draw(a,o,n)}),this.forceUpdate()}},{key:"renderPickColorBtn",value:function(){var t=document.getElementById("colorPicker");return t?i.a.createPortal(n.a.createElement("button",{onClick:this.setPickColorState},this.state.isPickingColor?"\u6b63\u5728\u53d6\u8272":"\u53d6\u8272"),t):null}},{key:"render",value:function(){var t=this;return n.a.createElement("div",{style:{border:"1px solid",display:"inline-block",height:this.props.height,width:this.props.width,overflow:"hidden",position:"relative"}},n.a.createElement("div",{style:{position:"absolute",left:0,top:0,overflow:"hidden"},ref:function(e){return t.canvasWrapper=e}},this.renderPickColorBtn(),n.a.createElement("span",{className:"dot-hover-box",style:{boxShadow:"0 0 1px 1px black",width:this.state.zoomRatio+"px",height:this.state.zoomRatio+"px",position:"absolute",left:this.state.dothoverX,top:this.state.dothoverY,pointerEvents:"none"}}),n.a.createElement("canvas",{ref:function(e){return t.canvas=e},style:{zoom:this.state.zoomRatio,imageRendering:"pixelated"}})))}}]),e}(o.PureComponent),m=a(36),g=(a(44),["#ff0000","#ffff00","#00ff00","#0000ff","#800080","#ffa500"]),y={width:"1em",height:"1em"},k={listStyle:"none",float:"left"};var C=function(t){return console.log("cs rendered"),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("input",{type:"color",value:t.color,onChange:function(e){return t.onChangeColor(e.target.value)}})),g.map(function(e){return n.a.createElement("li",{key:e,style:k},n.a.createElement("button",{style:Object(m.a)({},y,{backgroundColor:e}),onClick:function(){return t.onChangeColor(e)}}))}))},w=(a(45),a(35)),b=a.n(w),x=function(t){function e(t){var a;return Object(s.a)(this,e),(a=Object(c.a)(this,Object(p.a)(e).call(this,t))).handleChangeColor=function(t){a.setState({currentColor:t})},a.state={pixelData:null,currentColor:"#ffffff"},a.socket=b()(),a}return Object(u.a)(e,t),Object(l.a)(e,[{key:"componentDidMount",value:function(){var t=this;this.socket.on("init-data",function(e){console.log(e),t.setState({pixelData:e})})}},{key:"render",value:function(){return console.log("app rendered"),n.a.createElement("div",null,n.a.createElement(v,{width:200,height:200,socket:this.socket,color:this.state.currentColor,onPickColor:this.handleChangeColor}),n.a.createElement("span",{id:"colorPicker"}),n.a.createElement(C,{color:this.state.currentColor,onChangeColor:this.handleChangeColor}))}}]),e}(o.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(n.a.createElement(x,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[37,1,2]]]);
//# sourceMappingURL=main.d28fb60a.chunk.js.map